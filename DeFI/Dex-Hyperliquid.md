Hyperliquid 是专为链上衍生品高频交易定制的高性能 Layer 1，核心由**HyperBFT 共识**、**HyperCore 链上 CLOB**、**HyperEVM 兼容层**与**HyperStone 预言机**组成，通过 “共识 - 执行分离 + 双链统一状态”，实现 0.2 秒中位延迟、20 万 TPS 订单处理与即时最终性，同时保障 BFT 安全与 EVM 生态兼容。

------

### 一、整体架构与设计理念

Hyperliquid 采用 “**单共识双执行层**” 的模块化架构，将共识层与执行层解耦，同时用统一共识确保状态一致，核心目标是在去中心化与自托管前提下，达到 CEX 级交易性能。

- 共识层：HyperBFT（PoS-BFT 混合，基于 HotStuff 深度优化），为 HyperCore 与 HyperEVM 提供统一交易顺序与即时最终性。
- 执行层：
  - HyperCore：Rust 实现的链上 CLOB 引擎，负责订单撮合、保证金计算、清算与结算，零链下组件。
  - HyperEVM：EVM 兼容智能合约层（Cancun 分叉），支持 Solidity，通过预编译与 Events 读取 HyperCore 状态并触发交易。
- 跨链与预言机：LayerZero Composer 负责跨链资产桥接；HyperStone（集成 RedStone）提供 3 秒价格更新与 OEV 保护。

------

### 二、核心组件技术细节

#### 1. HyperBFT 共识机制（性能与安全的核心）

HyperBFT 源于 HotStuff 并针对低延迟交易深度优化，解决传统 BFT 的 O (n²) 通信瓶颈，实现 “高吞吐 + 即时最终性 + BFT 安全” 的平衡。

- 节点与角色：
  - 验证者集：约 20 个节点（按 HYPE 质押权重选出），含 hotValidatorSet（共识）与 coldValidatorSet（执行），领导者按质押权重轮换。
  - 法定人数：需超 2/3 质押权重签名（quorum）提交区块，容错 1/3 恶意节点。
- 四阶段共识流程（优化版 HotStuff）：
  1. 领导者打包交易并广播预准备消息。
  2. 验证者预准备投票后，领导者汇总并广播准备消息。
  3. 验证者准备投票后，领导者汇总并广播提交消息。
  4. 提交即达成即时最终性，无回滚风险。
- 关键优化：
  - 消息聚合：领导者统一广播，通信复杂度从 O (n²) 降至 O (n)。
  - 流水线处理：多轮共识并行，前一轮提交时后一轮已预准备，单轮共识约 0.1 秒。
  - 乐观执行：交易在最终确认前即可执行，减少等待时间。
- 性能指标：中位延迟 0.2 秒，99 分位 0.9 秒；订单处理约 20 万 TPS；即时最终性；验证者集每 10 万轮（约 30 分钟）更新。

#### 2. HyperCore：链上 CLOB 与清算引擎（交易性能的基石）

HyperCore 是 Hyperliquid 的交易核心，全流程链上处理，确保透明与确定性，专为高频衍生品设计。

- 核心能力：
  - 完全链上 CLOB：价格 - 时间优先撮合，每笔订单、取消、成交、清算均上链，具备即时最终性。
  - 并行执行：共识节点负责交易排序，执行节点并行处理订单匹配、保证金计算、强平，避免阻塞共识。
  - 内存状态机：全量账户与订单簿加载至内存，提升撮合速度。
- 清算机制：
  - 自动强平：保证金率低于阈值时，清算引擎触发市价平仓，交易即时最终，无回滚风险，防止穿仓。
  - ADL（自动减仓）：极端行情下，按盈利比例分摊亏损，保护保证金池。
- 性能：订单处理约 20 万 TPS，随节点优化持续提升。

#### 3. HyperEVM：EVM 兼容层（生态扩展的关键）

HyperEVM 为开发者提供熟悉的智能合约环境，同时深度集成 HyperCore，实现金融原语的可组合性。

- 核心设计：
  - 双块结构：小块（1 秒 / 2M gas）用于快速转账与轻量合约；大块（1 分钟 / 30M gas）用于复杂合约，平衡速度与容量。
  - 预编译与 Events：通过预编译代码读取 HyperCore 订单簿与仓位状态，通过 Events 触发 HyperCore 交易，实现无缝交互。
  - EVM 兼容性：支持 Solidity 0.8.x 及 PUSH0、transient storage 等 opcodes，降低迁移成本。
- 资产桥接：
  - LayerZero Composer：跨链资产通过 OFT 在 HyperEVM mint 后，经资产桥地址映射至 HyperCore，实现一键充值。

#### 4. HyperStone 预言机（价格安全的保障）

HyperStone 集成 RedStone，为衍生品交易提供低延迟、防操纵的价格数据。

- 核心特性：
  - 3 秒价格更新：覆盖 BTC、ETH、Solana 等多链资产，适配高频交易需求。
  - OEV 保护：通过订单流拍卖防止预言机价格操纵，保障清算安全。

------

### 三、关键技术创新与优势

1. 共识 - 执行分离：共识节点专注排序，执行节点并行处理交易，突破传统 BFT 的性能瓶颈。
2. 统一共识下的双链架构：HyperCore 与 HyperEVM 共享 HyperBFT，确保状态一致，兼顾交易性能与 EVM 生态兼容。
3. 即时最终性：交易提交即不可逆转，满足衍生品清算与结算的确定性需求，杜绝穿仓风险。
4. 全链上 CLOB：无需链下撮合，所有交易透明可追溯，同时保持 CEX 级速度。

------

### 四、性能对比（与主流公链 / 共识）

| 项目        | 共识机制 | 延迟     | TPS（订单） | 最终性   | 容错 | 通信复杂度 |
| ----------- | -------- | -------- | ----------- | -------- | ---- | ---------- |
| Hyperliquid | HyperBFT | 0.2 秒   | 20 万       | 即时     | 1/3  | O(n)       |
| Ethereum    | PoS      | 12–15 秒 | 30          | 6–12 块  | 1/3  | O(n²)      |
| Solana      | PoH+PBFT | 0.4 秒   | 6.5 万      | 15–30 秒 | 1/3  | O(n)       |
| Tendermint  | DPoS+BFT | 1–2 秒   | 1 万 +      | 多块     | 1/3  | O(n²)      |

------

### 五、局限性与未来方向

- 局限性：
  - 验证者数量少（约 20 个），去中心化程度低于以太坊等公链。
  - 执行层成为瓶颈，高并发下需进一步优化并行处理能力。
  - 双链架构增加节点存储与计算负担，对硬件有一定要求。
- 未来方向：
  - 优化执行节点并行处理，提升整体吞吐量。
  - 扩展验证者集，在性能与去中心化间寻找平衡。
  - 增强跨链互操作性，接入更多公链资产。

------

### 总结

Hyperliquid 的技术核心是 “**场景化定制的高性能架构**”，通过 HyperBFT 共识、HyperCore 链上 CLOB、HyperEVM 兼容层的深度协同，在去中心化与自托管的基础上，实现了衍生品交易所需的低延迟、高吞吐与即时最终性。其设计思路是放弃通用公链的 “全能性”，聚焦高频衍生品交易的核心需求，成为去中心化衍生品市场的技术标杆。