# 1inch

1inch 的核心根基是**流动性聚合与智能路由**，以此解决早期 DEX 的高滑点、低效率问题；在此之上，延伸出**意图式交易**的核心载体限价订单协议，再通过 Fusion/Fusion + 协议完善单链与跨链交易场景，搭配解析者竞争体系保障执行效率，最后以治理与辅助模块兜底安全性和生态灵活性，整体呈 “核心根基 - 核心交易载体 - 场景化协议 - 支撑体系 - 辅助兜底” 的层级扩展，具体如下：

## 一、最核心根基：流动性聚合 + 智能路由

这是 1inch 诞生之初就确立的核心机制，也是其所有交易功能的基础，核心目标是为用户找到最优交易路径、降低滑点损失。

- **核心逻辑**：1inch 自身并非传统意义上的 DEX，而是整合了 Uniswap、SushiSwap、Curve Finance 等主流 DEX 的流动性。当用户发起交易时，其自主研发的智能路由算法会实时扫描所有合作 DEX 的交易对价格、流动性深度等数据，通过复杂模型计算后，将用户订单拆分到不同 DEX，或选择单一最优 DEX，以此实现成本最低、滑点最小的交易执行。比如用户大额兑换某代币时，算法可能将订单拆分到 3 - 5 个流动性充足的 DEX，避免单一 DEX 因订单过大导致价格剧烈波动。

- **延伸价值**：该机制不仅让 1inch 拥有远超单一 DEX 的流动性深度，还为后续各类复杂交易场景（如大额限价单、跨链兑换）提供了基础 —— 只有整合全市场流动性，后续模块才能实现 “最优报价”“多场景适配” 等功能。

## 二、核心交易载体：限价订单协议（LOP）

   作为 1inch 意图式交易的核心支撑模块，LOP 承接了核心根基的流动性优势，将简单的 “即时兑换” 升级为 “可编程条件交易”，是连接用户意图与实际执行的关键桥梁。其核心功能围绕 “灵活约束 + 安全验证” 展开：

   - **精细化订单条件配置**：用户除设置兑换金额、目标价格外，还能添加丰富约束条件，比如指定订单 10 天内有效、仅允许特定地址处理订单（实现私密交易）、禁止部分填充避免多次交割麻烦等。甚至可嵌入自定义逻辑，如 “交易前调用某预言机确认价格达标”，实现止损、止盈等复杂需求。
   - **密码学保障订单有效性**：订单包含 salt 参数，该参数记录附加数据的哈希值。当后续处理订单时，链上合约会验证附加数据与 salt 参数的一致性，防止他人篡改订单条件。同时支持批量失效功能，用户可通过 nonce（随机数）或 epoch 参数，一键作废批量错误订单或关联订单，避免重复交易损失。
   - **多场景适配能力**：LOP 的订单结构可适配拍卖、跨链兑换等高级场景。例如用户提交跨链订单时，订单验证逻辑中可加入对另一链 “资金到账证明” 的检查，让单链和跨链交易共用一套基础技术框架。

## 三、场景化扩展协议：Fusion 与 Fusion+


   这两个协议是基于限价订单协议的场景化落地延伸，分别聚焦单链和跨链场景，将意图式交易的优势进一步放大，核心是解决 “无 Gas 交易” 和 “跨链安全” 两大痛点。

   - **Fusion 协议（单链场景）**：核心是实现 “无 Gas 交易”。用户作为订单创建者提交兑换意图后，无需持有 ETH 等原生代币支付 Gas 费。解析者竞争处理订单时，会主动承担 Gas 成本，并将其折算到交易报价中。同时，订单通过荷兰拍卖模式让解析者竞争，报价从高到低调整，直到有解析者接单、价格低于用户滑点容忍度或订单过期，保障用户能获得较优价格。
   - **Fusion + 协议（跨链场景）**：在 Fusion 无 Gas、防 MEV 的基础上，解决跨链交易的同步性和安全性问题。解析者需在源链托管合约存入用户待兑换资产，同时在目标链托管合约存入对应兑换资产，两条链的合约通过密钥哈希关联。只有中继节点验证两边资产均到位后，才会公开密钥，用户和解析者凭密钥提取对应资产。若交易失败，锁定期结束后可触发资产退回流程，避免用户资产长期锁定。

## 四、关键支撑体系：解析者竞争与约束机制


   该模块是保障 Fusion/Fusion + 协议、限价订单协议高效执行的 “执行者” 体系，通过专业角色分工和激励约束规则，确保用户意图能顺利落地。

   - **解析者准入与竞争规则**：解析者需质押 1INCH 代币并完成注册才能参与订单处理。用户订单提交后，1inch 会将其广播给所有解析者并触发荷兰拍卖，解析者需不断优化报价争夺订单处理权，报价最优者最终锁定资产成为执行者。这种竞争机制倒逼解析者给出更优交易条件。
   - **履约保障与收益机制**：解析者处理订单时，需匹配全市场流动性设计最优路径。同时其质押的代币相当于保证金，若出现恶意违约、未按时履约等情况，质押代币可能被扣除；若交易顺利完成，解析者可获得订单手续费作为收益，此外还能参与 1inch 的 Gas 退款计划、获得治理投票权等额外激励。

## 五、辅助兜底模块：治理与异常恢复机制

   该层级模块为整个 1inch 生态提供稳定性兜底，涵盖治理决策和交易风险防控，确保生态长期健康运行。

   - **1inch DAO 治理模块**：原生代币 1INCH 的持有者可参与平台治理，投票决定协议参数调整、新功能上线、合作项目推进等关键事项。例如是否调整解析者的质押额度、是否新增支持的链等，通过去中心化治理让生态发展贴合社区需求。同时 1INCH 可用于抵扣交易手续费，提升代币实用性。
   - **交易优化与异常兜底**：一方面，V4 版本的限价订单协议支持 Permit2 功能，省去用户重复授权代币的步骤，让交易更省 Gas，其中升级后的限价单 Gas 效率提升 14%；另一方面，针对订单过期、解析者未履约等情况，设置了无成本重提交机制，用户无需为失败或过期订单支付任何费用，极大降低交易风险。

-------





# Pathfinder 算法：1inch 流动性聚合的核心引擎

Pathfinder 是 1inch 自主研发的智能路由算法，也是其 “DEX 聚合 + 最优路径” 核心模式的技术基石。该算法通过毫秒级扫描全市场流动性、多维度路径规划与订单拆分，解决了单一 DEX 流动性分散、滑点高、Gas 成本不可控的痛点，最终为用户提供 “兑换率最优 + 成本最低” 的交易执行方案。自 1inch 上线以来，Pathfinder 已历经多次重大迭代（2025 年 6 月最新版本进一步优化跨链与集中流动性利用效率），成为 DeFi 领域最成熟的交易路由算法之一。

## 一、算法核心定位与核心目标

### 1. 核心定位

Pathfinder 并非简单的 “价格对比工具”，而是一套 “全链路交易优化系统”—— 它以 1inch 聚合的 250+ 流动性源（含主流 DEX、机构做市商、借贷协议流动性池等）为数据基础，通过复杂的数学模型与实时计算，打通 “**流动性筛选→路径规划→订单拆分→Gas 平衡→原子执行**” 的全流程，本质是 “链下高效计算 + 链上精准执行” 的协同引擎。

### 2. 三大核心目标

- **最小滑点**：通过分散交易、多路径组合，规避单池大额交易导致的价格冲击；
- **最优兑换率**：综合对比全市场流动性报价，挖掘直接 / 间接兑换路径中的最优组合；
- **最低综合成本**：平衡兑换价差收益与 Gas 费支出，避免 “报价最优但 Gas 过高” 的无效路径。

## 二、算法核心工作原理（从数据输入到路径输出）

Pathfinder 的工作流程可拆解为 “**数据采集→路径挖掘→成本计算→方案排序→动态调整**” 五大环节，每个环节都围绕 “最优性” 与 “实时性” 设计：

### 1. 第一步：毫秒级全维度数据采集

算法的优化基础是 “数据全面性”，Pathfinder 会以 **100-300 毫秒 / 次** 的频率，同步所有接入流动性源的核心数据，覆盖三大维度：

- **流动性数据**：各 DEX 资金池的代币储备量（深度）、当前买卖盘价格、交易对手续费率（如 Uniswap V3 的 0.05%/0.3%/1% 费率池）；
- **市场动态数据**：链上 Gas 费实时波动（Base Fee + Priority Fee）、代币价格瞬时变化、流动性池资金流入 / 流出情况；
- **约束条件数据**：用户自定义参数（滑点容忍度、是否允许部分填充、交易有效期）、协议级规则（如部分 DEX 的交易限额、跨链桥延迟）。

**举例**：当用户发起 ETH→USDT 交易时，算法会同时抓取 Uniswap V2/V3、Curve、SushiSwap、Balancer 等 20+ 个相关资金池的实时储备量（如 Uniswap V3 0.3% 池有 5000 ETH 储备，Curve 池有 1 万 ETH 储备）、当前兑换汇率（如 1 ETH=1800 USDT vs 1 ETH=1798 USDT）、以及当前以太坊 Gas 费（20 gwei）。

### 2. 第二步：多维度路径挖掘（突破 “直接兑换” 局限）

Pathfinder 最核心的创新的是 “不局限于两代币直接兑换”，而是通过算法挖掘全量可能的交易路径，包括三类核心路径：

- **直接路径**：目标代币对的直连流动性池（如 ETH→USDT 直接在 Uniswap 池兑换）；
- **间接路径**：通过 1 个或多个中间代币的多步兑换（如 ETH→WBTC→USDT、ETH→DAI→USDC→USDT）；
- **混合路径**：结合单链多池、跨池拆分的组合路径（如 40% ETH 在 Uniswap 直兑 USDT，60% ETH 经 DAI 中转后在 Curve 兑 USDT）。

算法通过 “**图论模型**” 将所有代币视为节点、流动性池视为边，采用优化后的 **Dijkstra 算法**（适配 DeFi 流动性动态变化场景），在毫秒级内遍历所有可能路径，排除 “无效路径”（如中间步骤过多导致 Gas 激增、流动性不足无法完成交易）。

**举例**：用户想兑换 SHIB→BONK，若两者无直接流动性池，Pathfinder 会挖掘出 SHIB→USDC→BONK、SHIB→ETH→BONK 等多条间接路径，并计算每条路径的最终兑换率（扣除中间步骤手续费后），最终选择 “SHIB→USDC→BONK”（兑换率 1 SHIB=0.002 BONK）而非 “SHIB→ETH→BONK”（兑换率 1 SHIB=0.0018 BONK）。

### 3. 第三步：订单拆分与成本精细化计算

对于大额交易（或单一路径流动性不足的交易），Pathfinder 会启动 “订单拆分机制”，同时计算每条路径的 “综合成本”，确保拆分后整体收益最优：

- **拆分逻辑**：根据各流动性池的 “深度阈值”（即该池能承接的最大交易量而不引发大幅滑点），将用户订单拆分为 N 个小额订单，分散到多个路径 / 池子中。拆分比例由算法动态计算，核心原则是 “滑点边际效益最大化”—— 即每笔拆分订单的滑点增量最低。

  - 举例：用户兑换 1000 ETH→USDT，单一 Uniswap 池承接后滑点会达 5%（1 ETH 从 1800 USDT 跌至 1710 USDT），而 Pathfinder 会拆分：400 ETH（Uniswap V3，滑点 0.5%）、300 ETH（Curve，滑点 0.3%）、200 ETH（SushiSwap，滑点 0.4%）、100 ETH（Balancer，滑点 0.6%），整体滑点降至 0.45%。

- **综合成本计算**：算法不会只看兑换率，而是计算 “净收益”= 兑换金额 - 滑点损失 - Gas 成本，核心公式：

  ```plaintext
  净收益 = （∑ 各拆分订单兑换金额） - （∑ 各路径滑点损失） - （链上执行 Gas 费）
  ```

  其中，Gas 成本会根据路径复杂度（如多步兑换的合约调用次数）动态估算，避免 “报价最优但 Gas 费吞噬全部收益” 的情况。

  - 举例：某间接路径兑换率比直接路径高 0.3%，但需 3 次合约调用，Gas 费比直接路径高 0.5%，算法会舍弃该间接路径，选择 “兑换率略低但 Gas 更低” 的直接路径。

### 4. 第四步：路径排序与最优方案输出

Pathfinder 会对所有挖掘出的路径（含拆分后组合路径）按 “净收益” 排序，筛选出 Top 3 最优方案，最终向用户展示 “最优兑换率” 对应的方案。同时，算法会预留 “价格波动缓冲”—— 计算出的路径会包含一个 “可接受价格区间”，若链上执行时市场价格波动超出该区间（未达用户滑点容忍度），交易会自动回滚。

### 5. 第五步：动态调整（适配市场实时波动）

DeFi 市场价格与流动性瞬息万变，Pathfinder 会在用户确认交易后、链上执行前，再次校验最优路径的有效性：若核心流动性池的价格或深度发生重大变化（如滑点突然升高 1% 以上），算法会实时重新计算路径，确保最终执行的方案仍是当前最优。

## 三、关键技术升级与迭代亮点

Pathfinder 并非一成不变，而是随 1inch 协议版本迭代持续优化，核心升级方向集中在 “效率、深度、兼容性” 三大维度：

| 迭代阶段                   | 核心升级点                                                   | 实际效果                                                     |
| -------------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 早期版本（V2-V3）          | 基础直接路径挖掘 + 简单订单拆分                              | 解决单一 DEX 滑点问题，大额交易滑点降低 30%+                 |
| 2024 版本                  | 支持多步间接路径 + Gas 成本精准测算                          | 挖掘出更多高收益间接路径，综合成本降低 15-20%                |
| 2025 年 6 月升级（最新版） | 1. 集中流动性深度利用（适配 Uniswap V3 等）；2. 路径合并去冗余；3. 跨链路径优化 | 1. 兑换率优化 6.5%；2. Gas 费降低 25%；3. 跨链交易路径响应速度提升 40% |

### 核心升级细节：

1. **集中流动性深度利用**：针对 Uniswap V3 等 “集中流动性池”（不同价格区间流动性集中），算法会精准定位 “最优价格区间” 的流动性，避免因盲目调用池子导致的滑点浪费；
2. **路径合并去冗余**：旧版算法在多步兑换时可能存在 “重复中间步骤”（如 A→B→C 和 A→B→D 重复 A→B），新版会合并冗余步骤，减少合约调用次数，降低 Gas 费；
3. **跨链路径优化**：适配 1inch Fusion+ 跨链协议，将跨链桥延迟、跨链手续费纳入路径计算，实现 “单链 + 跨链” 一体化最优路径规划。

## 四、算法应用场景与用户价值

Pathfinder 算法的价值在不同交易场景中均有体现，核心用户价值可总结为 “三降一升”：

### 1. 核心应用场景

- **大额交易**：是算法最能发挥价值的场景，通过多池拆分，100 ETH 以上的大额兑换滑点可控制在 0.5% 以内（单一 DEX 可能达 5%+）；
- **小众代币交易**：小众代币流动性分散，算法可通过多中间代币路径，实现 “无直接池也能高效兑换”，避免无法成交或滑点极高的问题；
- **跨链交易**：结合 Fusion+ 协议，算法规划跨链路径时，会同时对比不同跨链桥的成本与速度，选择 “跨链费最低 + 兑换率最优” 的组合；
- **普通小额交易**：算法会快速匹配单一最优流动性池，确保交易速度快、Gas 费低，无需复杂拆分。

### 2. 用户核心收益

- **降滑点**：大额交易滑点平均降低 40-70%，小众代币交易滑点降低 50%+；
- **降成本**：综合 Gas 费降低 20-30%（路径合并 + 高效路径选择）；
- **降门槛**：用户无需了解不同 DEX 的流动性情况，算法自动完成最优选择；
- **升效率**：路径计算耗时仅 100-300 毫秒，交易执行速度与单一 DEX 无差异。

## 五、算法局限性与未来方向

### 1. 现存局限性

- 对极端市场波动的响应仍有上限：若某核心流动性池在交易执行瞬间被大额抽离，可能导致实际滑点超出预期（概率极低，且 1inch 有滑点保护机制）；
- 跨链场景依赖跨链桥性能：若跨链桥出现延迟或拥堵，算法规划的跨链路径效率会受影响；
- 复杂路径的 Gas 估算存在微小误差：多步兑换的 Gas 费受链上拥堵影响，可能与算法预估算存在 5-10% 的偏差。

### 2. 未来迭代方向

- **AI 驱动的动态预测**：引入机器学习模型，预测流动性池资金流向与价格波动，提前规划 “抗波动路径”；
- **多链流动性一体化调度**：进一步优化跨链路径，实现 “单笔交易调用多条链的流动性”，突破单链流动性上限；
- **自定义策略适配**：允许专业用户自定义算法参数（如偏好某类 DEX、优先低 Gas 路径等），提升算法灵活性。







# Aqua 共享流动性协议（2025.11）

1inch Aqua 是 1inch 推出的 **“非锁仓式流动性提供工具”**，核心是让用户在不长期锁定资金的前提下，享受 Uniswap V3 等 DEX 的流动性手续费分成，本质是 “代理托管授权 + 交易时临时调用” 的优化方案，适配 “想赚手续费又想保资金灵活” 的需求。

### 一、核心特点：“只授权不锁仓”（资金始终在用户钱包）

- **授权逻辑**：用户仅需向 Aqua 代理合约授予代币使用权限（如 600 USDC），无需像普通 Uniswap LP 那样将资金转入流动性池 —— 授权后资金仍在用户钱包，余额不变，也不会生成 LP NFT。
- **临时调用机制**：只有当 Uniswap V3 池出现匹配交易（如他人用 USDT 买 USDC）时，代理合约才会凭借授权，临时划转所需数量的资金（而非全部授权额度）完成撮合；交易结束后，“未使用的资金 + 交易所得代币 + 手续费” 会通过原子交易即时归还用户钱包，全程毫秒级完成。

### 二、核心优势：灵活、安全、兼顾收益

1. **资金灵活性拉满**：资金不锁仓，始终在用户钱包，可随时撤销授权、自由支配（比如直接转账、参与其他 DeFi 项目），无需像普通 LP 那样走 “赎回拆仓” 流程。
2. **风险可控**：依赖 EVM 原子性交易（交易失败会全额回滚，资金无损失）+ 代理合约权限限制（仅能用于 DEX 交易撮合，无法转至其他地址），安全性有保障。
3. **收益不打折**：代理合约会通过 Uniswap 适配层，向 Uniswap 登记 “流动性意向”（证明资金已授权、可用），用户会被计入 LP 名单，按资金占比分配手续费，收益逻辑与普通 Uniswap LP 一致。

### 三、与 Uniswap 普通 LP 的核心差异

| 对比维度   | Uniswap 普通 LP                                | 1inch Aqua                         |
| ---------- | ---------------------------------------------- | ---------------------------------- |
| 资金归属   | 长期存入 Uniswap 池（锁定）                    | 始终在用户钱包（仅交易时临时调用） |
| 授权对象   | Uniswap 核心合约（NonfungiblePositionManager） | Aqua 代理合约                      |
| 流动性凭证 | 发放 ERC721 LP NFT                             | 无 NFT，授权记录即权益凭证         |
| 资金灵活性 | 低（需赎回才能解锁）                           | 高（随时支配、撤销授权）           |
| 转账时机   | 授权后立即转入池内                             | 交易触发时临时划转，交易后归还     |

### 四、适用场景

适合 “不想长期锁定资金，但想赚取 DEX 手续费分成” 的用户 —— 比如持有闲置稳定币（USDC/USDT），既想获得被动收益，又需要资金随时可用（应对其他投资机会或日常转账），无需承担普通 LP 的 “锁仓流动性风险”。




