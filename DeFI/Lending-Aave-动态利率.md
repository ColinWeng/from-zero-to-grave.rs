

Aave 动态利率模型的核心是 **“资金利用率驱动分段计息 + 共享指数 + 个人缩放值实现公平高效复利”**，既通过市场化利率平衡资金供需，又通过链上优化设计兼顾公平性、精准度与 Gas 效率，最终实现 “借款利率随供需波动、存款利率被动跟随、所有用户按实际占用资金时长计息” 的目标。



## 一、动态利率模型核心框架

### 1. 核心定价逻辑：资金利用率（U）驱动分段计息

利率的核心变量是 **资金利用率**，即：

```
资金利用率（U）= 该资产总债务（浮动+稳定）÷ 该资产总可用流动性（存款总额-提取+还款-借款）
```

借款利率（分浮动 / 稳定，仅参数不同）按 U 分两段计算，由 Aave DAO 为每种资产预设核心参数：

| 参数                      | 作用                                                 | 典型值（USDC 示例） |
| ------------------------- | ---------------------------------------------------- | ------------------- |
| 基础利率（R_base）        | 利率底值，无借贷需求时的初始利率                     | 0.5%                |
| 最优利用率（U_opt）       | 供需平衡点，超此值利率陡峭增长                       | 80%                 |
| 斜率 1（R_slope1）        | U＜U_opt 时，利率平缓增长斜率（鼓励借贷）            | 3.5%                |
| 斜率 2（R_slope2）        | U≥U_opt 时，利率陡峭增长斜率（抑制过度借贷）         | 45%                 |
| 储备因子（reserveFactor） | 协议抽成比例（借款利息的 X% 归协议，剩余分给存款人） | 10%                 |

**核心公式**

- 当 U ＜ U_opt（供需宽松）：`浮动借款利率 = R_base + (U / U_opt) × R_slope1`
- 当 U ≥ U_opt（供需紧张）：`浮动借款利率 = R_base + R_slope1 + [(U - U_opt)/(1 - U_opt)] × R_slope2`
- 存款利率（被动跟随）：`存款利率 = 浮动借款利率 × U × (1 - 储备因子)`

### 2. 链上计息实现：共享指数 + 个人缩放值

为解决链上复利精准度、Gas 成本和公平性问题，模型设计了两个核心变量：

| 变量名称                                       | 作用范围               | 核心作用                                                     | 特性                                                         |
| ---------------------------------------------- | ---------------------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 共享指数（variableBorrowIndex/liquidityIndex） | 资产级（所有用户共用） | 统一跟踪该资产的利率变化 + 秒级复利，更新公式：`新指数 = 旧指数 × (1 + 当期利率 × 时间间隔/365)`（时间间隔精确到秒） | 仅在 “该资产有操作（存 / 借 / 还 / 清算）” 时触发更新，避免无效消耗 |
| 个人缩放值（scaledVariableDebt/scaledBalance） | 用户 + 资产级（专属）  | 借款时：`scaledVariableDebt = 借款本金 ÷ 借款时的共享指数`；存款时：`scaledBalance = 存款本金 ÷ 存款时的共享指数` | 一旦确定终身不变，仅用于匹配个人资金规模                     |

**最终计息逻辑**

- 借款用户总负债（本金 + 利息）= 个人缩放值 × 最新共享指数
- 存款用户总本息 = 个人缩放值 × 最新共享指数
- 核心公平性保障：**用户仅承担 “借款 / 存款后经历的利率 × 时间”，利率变化不追溯历史利息，不同时间操作的用户按同一规则计息**。

### 3. 关键规则

1. 利率波动仅对 “变化后的时间段” 生效，历史利息按当时利率计算；
2. 共享指数是 “资产级公共标尺”，确保同一资产的所有用户利率标准一致；
3. 个人缩放值是 “专属资金刻度”，确保利息与个人借款 / 存款规模匹配；
4. 指数按秒级时间间隔更新，无论用户何时操作，都精准核算实际占用资金时长。

## 二、完整实战示例（跨时间段 + 利率波动场景）

以以太坊主网 USDC 为例，模拟 3 个用户的操作（跨 3 个利率阶段），直观展示利率计算全流程：

### 前提：USDC 核心参数

R_base=0.5%、U_opt=80%、R_slope1=3.5%、R_slope2=45%、储备因子 = 10%

### 场景时间线与利率变化

| 时间节点          | 持续时长 | 资金利用率（U） | 浮动借款利率（计算结果）              | 共享指数（USDC）   |
| ----------------- | -------- | --------------- | ------------------------------------- | ------------------ |
| T0（Day0 00:00）  | 30 天    | 50%（宽松）     | 0.5% + (50%/80%)×3.5%=2.6875%         | 1.0（初始值）      |
| T1（Day30 00:00） | 20 天    | 90%（紧张）     | 0.5%+3.5%+[(90%-80%)/(20%)]×45%=26.5% | 1.003288（更新后） |
| T2（Day50 00:00） | 15 天    | 70%（回归宽松） | 0.5% + (70%/80%)×3.5%=3.5625%         | 1.01769（更新后）  |
| T3（Day65 00:00） | -        | -               | -                                     | 1.02075（更新后）  |

### 三个用户操作与利息计算

**1. 用户甲：T0 借款 10,000 USDC（浮动利率），T3 还款**

- 借款时（T0）：共享指数 = 1.0 → 个人缩放值 = 10,000 ÷ 1.0=10,000
- 还款时（T3）：总负债 = 10,000 × 1.02075=10,207.5 USDC
- 总利息 = 10,207.5 - 10,000=207.5 USDC（覆盖 3 个利率阶段，共 65 天）

**2. 用户乙：T1 借款 10,000 USDC（浮动利率），T3 还款**

- 借款时（T1）：共享指数 = 1.003288 → 个人缩放值 = 10,000 ÷ 1.003288≈9967.3
- 还款时（T3）：总负债 = 9967.3 × 1.02075≈10,174.0 USDC
- 总利息 = 10,174.0 - 10,000=174.0 USDC（覆盖后 2 个利率阶段，共 35 天）

**3. 用户丙：T0 存款 10,000 USDC，T3 提现**

- 存款时（T0）：共享指数 = 1.0 → 个人缩放值 = 10,000 ÷ 1.0=10,000
- 提现时（T3）：总本息 = 10,000 × 1.02075=10,207.5 USDC
- 总利息 = 207.5 USDC（与用户甲的借款利息对应，扣除协议 10% 抽成后，存款利息 = 借款利息 ×U×90%，最终通过指数同步）

### 关键细节拆解（以用户乙为例）

用户乙在 T1（Day30）借款，仅经历 T1-T2（20 天，利率 26.5%）和 T2-T3（15 天，利率 3.5625%）两个阶段：

1. T1-T2 阶段（20 天）：

   指数从 1.003288 涨到 1.01769 → 增量 = 0.014402

   该阶段利息 = 9967.3 × 0.014402≈143.5 USDC

2. T2-T3 阶段（15 天）：

   指数从 1.01769 涨到 1.02075 → 增量 = 0.00306

   该阶段利息 = 9967.3 × 0.00306≈30.5 USDC

3. 总利息 = 143.5+30.5=174.0 USDC，完全匹配 “实际借款时长 × 对应利率”，**未承担 T0-T1 阶段的利息**。

## 三、模型核心优势总结

1. **市场化定价**：利率随资金利用率波动，供需宽松时鼓励借贷，紧张时抑制过度占用，平衡资金池流动性；
2. **公平高效**：共享指数确保同一资产的利率标准对所有用户一致，个人缩放值精准匹配资金规模，秒级计息避免时间遗漏；
3. **低 Gas 成本**：共享指数仅按资产更新（而非按用户），存储和计算成本随资产数量增长，不随用户数量爆炸；
4. **风险可控**：U≥U_opt 时利率陡峭增长，防止资金池耗尽，同时储备因子为协议留存风险准备金。

## 四、用户视角核心结论

1. 浮动借款用户：利息 = 实际借款时长 × 各阶段利率的复利总和，利率上涨仅影响后续利息，不追溯历史；
2. 存款用户：收益被动跟随借款利率和资金利用率，借贷需求越旺盛，存款收益越高；
3. 操作无额外成本：无需关注指数更新或利率变化，合约自动核算，还款 / 提现时仅需支付 / 收取 “总负债 / 总本息” 即可。

该模型是 Aave 平衡 “资金效率、公平性、链上成本” 的核心设计，也是主流 DeFi 借贷协议（如 Compound）的通用最优解。
